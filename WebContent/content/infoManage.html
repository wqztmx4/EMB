<div class="easyui-layout" data-options="fit:true">
	<!-- Begin of toolbar -->
	<div id="infoManage-toolbar">
		<div class="wu-toolbar-button">
			<!-- <a href="#" class="easyui-linkbutton" iconCls="icon-add" onclick="openAdd()" plain="true">新增</a> 
			<a href="#" class="easyui-linkbutton" iconCls="icon-edit" onclick="openEdit()" plain="true">修改</a> 
			<a href="#" class="easyui-linkbutton" iconCls="icon-remove" onclick="remove()" plain="true">删除</a> -->
			<a href="#" class="easyui-linkbutton" iconCls="icon-tip" onclick="cancel()" plain="true">查看</a> 
			<a href="#" class="easyui-linkbutton" iconCls="icon-save" onclick="reload()" plain="true">导入</a>
			<!-- <a href="#" class="easyui-linkbutton" iconCls="icon-print" onclick="openAdd()" plain="true">打印</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-help" onclick="openEdit()" plain="true">帮助</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-undo" onclick="remove()" plain="true">撤销</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-redo" onclick="cancel()" plain="true">重做</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-sum" onclick="reload()" plain="true">总计</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-back" onclick="reload()" plain="true">返回</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-tip" onclick="reload()" plain="true">提示</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-save" onclick="reload()" plain="true">保存</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-cut" onclick="reload()" plain="true">剪切</a> -->
		</div>
		<div class="wu-toolbar-search">
			<label>起始时间：</label>
			<input id="search_startDate" class="easyui-datebox" style="width: 100px"> 
			<label>结束时间：</label>
			<input id="search_endDate" class="easyui-datebox" style="width: 100px"> 
				<label>企 业 类 型：</label> 
				<select id="search_enterpriseType" class="easyui-combobox" panelHeight="auto" style="width: 100px">
					<option value="">全部类型</option>
					<option value="101">危化品使用</option>
					<option value="102">危化品经营</option>
					<option value="103">危化品生产</option>
				</select> 
			<label>企 业 名 称：</label>
			<input id = "search_enterpriseName" class="wu-text" style="width: 100px">
			<label>县 区：</label> 
			<select id="search_countries" class="easyui-combobox" panelHeight="auto" style="width: 100px">
				<option value="">所有区县</option>
				<option value="1">市直</option>
				<option value="2">青州</option>
				<option value="3">诸城</option>
				<option value="4">寿光</option>
				<option value="5">高密</option>
				<option value="6">昌邑</option>
				<option value="7">临朐</option>
				<option value="8">昌乐</option>
			</select> 
			<a href="#" class="easyui-linkbutton" iconCls="icon-search" onclick="searchInfoManage()">开始检索</a>
		</div>
	</div>
	<!-- End of toolbar -->
	<table id="infoManage-datagrid" class="easyui-datagrid" toolbar="#wu-toolbar-2"></table>
</div>
<!-- Begin of easyui-dialog -->
<div id="infoManage-dialog" class="easyui-dialog" data-options="closed:true,iconCls:'icon-save'" style="width: 700px; padding: 10px;">
	<form id="infoManage-form" method="post">
		<table>
			<tr>
                <td width="80" align="right">企 业 名 称:</td>
                <td><input id = "enterpriseName" type="text" name="enterpriseName" class="wu-text" /></td>
            </tr>
            <tr>
                <td align="right">发 布 时 间:</td>
                <td><input id = "publicDate" type="text" name="publicDate" class="wu-text" /></td>
            </tr>
            <tr>
                <td align="right">承 诺 人:</td>
                <td><input id = "acceptor" type="text" name="acceptor" class="wu-text" /></td>
            </tr>
            <tr>
                <td align="right">企 业 类 型:</td>
                <td><select id="enterpriseType" class="easyui-combobox" name="enterpriseType" style="width:200px;">
                	<option value="101">危化品使用</option>
    				<option value="102">危化品经营</option>
    				<option value="103">危化品生产</option>
                </select>
                </td>
            </tr>
            <tr>
                <td align="right">县 区:</td>
                <td><select id="countries" class="easyui-combobox" name="countries" style="width:200px;">
    					<option value="1">市直</option>
    					<option value="2">青州</option>
    					<option value="3">诸城</option>
    					<option value="4">寿光</option>
    					<option value="5">高密</option>
    					<option value="6">昌邑</option>
    					<option value="7">临朐</option>
    					<option value="8">昌乐</option>
    					<option value="9">高新</option>
    					<option value="10">滨海</option>
    					<option value="11">保税</option>
    					<option value="12">峡山</option>
    					<option value="13">经济</option>
					</select>                
                </td>
            </tr>
            <tr>
                <td valign="top" align="right">发 布 内 容:</td>
                <td><textarea id = "publicContent" name="publicContent" rows="15" class="wu-textarea" style="width:520px"></textarea></td>
            </tr>
		</table>
	</form>
</div>
<!-- End of easyui-dialog -->
<script type="text/javascript">
	function searchInfoManage(){
	
		  $.ajax({
				url:'infoManage?method=select',
				data:{
					search_startDate:$('#search_startDate').val(),
					search_endDate:$('#search_endDate').val(),
					search_enterpriseType:$('#search_enterpriseType').combobox('getValue'),
					search_countries:$('#search_countries').combobox('getValue'),
					search_enterpriseName:$('#search_enterpriseName').val()
				},
				success:function(data){
						 $('#infoManage-datagrid').datagrid('loadData',data);
				}	
			});
			
	}

	/**
	 * Name 分页过滤器
	 */
	function pagerFilter(data) {
		if (typeof data.length == 'number' && typeof data.splice == 'function') {// is array                
			data = {
				total : data.length,
				rows : data
			}
		}
		var dg = $(this);
		var opts = dg.datagrid('options');
		var pager = dg.datagrid('getPager');
		pager.pagination({
			onSelectPage : function(pageNum, pageSize) {
				opts.pageNumber = pageNum;
				opts.pageSize = pageSize;
				pager.pagination('refresh', {
					pageNumber : pageNum,
					pageSize : pageSize
				});
				dg.datagrid('loadData', data);
			}
		});
		if (!data.originalRows) {
			data.originalRows = (data.rows);
		}
		var start = (opts.pageNumber - 1) * parseInt(opts.pageSize);
		var end = start + parseInt(opts.pageSize);
		data.rows = (data.originalRows.slice(start, end));
		return data;
	}

	/**
	 * Name 载入数据
	 */
	$('#infoManage-datagrid').datagrid({
		url : 'infoManage?method=select',
		loadFilter : pagerFilter,
		rownumbers : true,
		singleSelect : false,
		pageSize : 20,
		pagination : true,
		multiSort : true,
		fitColumns : true,
		fit : true,
		columns : [ [ {
			checkbox : true
		},  {
			field : 'id',
			title : '信息ID',
			width : 30,
			sortable : true,
			hidden:true
		}, {
			field : 'enterpriseName',
			title : '企业名称',
			width : 100,
			sortable : true,
			formatter: function(value,row,index){
				return row.enterprise.enterpriseName;
			}
		}, {
			field : 'publicDate',
			title : '发布时间',
			width : 80,
			formatter: function(value,row,index){
				var date = new Date(row.publicDate);
				date = date.getFullYear()+"-"+date.getMonth()+"-"+date.getDate();
				return date;
			}
		}, {
			field : 'enterpriseType',
			title : '企业类型',
			width : 100,formatter:function (value, row , index){
				switch (row.enterprise.enterpriseType) {
				case '101':
					return "危化品使用";
					break;
				case '102':
					return "危化品经营";
					break;
				case '103':
					return "危化品生产";
					break;
				default:
					break;
				}}
		}, {
			field : 'countries',
			title : '县区',
			width : 100,formatter:function(value,row,index){
				switch (row.enterprise.countries) {
				case 1:
					return "市直";
					break;
				case 2:
					return "青州";
					break;
				case 3:
					return "诸城";
					break;
				case 4:
					return "寿光";
					break;
				case 5:
					return "安丘";
					break;
				case 6:
					return "高密";
					break;
				case 7:
					return "昌邑";
					break;
				case 8:
					return "临朐";
					break;
				case 9:
					return "昌乐";
					break;
				default:
					return "";
					break;
				}
				
			}
		}, {
			field : 'publicContent',
			title : '发布内容',
			width : 280
		}, {
			field : 'enterpriseId',
			title : '企业ID',
			width : 30,
			hidden:true,
			formatter:function(value,row,index){
				return row.enterprise.enterpriseId;
			}
		}]],
		onDblClickRow: function(rowIndex, rowData){
			$('#infoManage-form').form('clear');
			//alert(item.productid);return;
			$.ajax({
				url:'infoManage?method=select',
				data:{
					id:rowData.id
				},
				success:function(data){
					if(data){
						//对返回时间做处理
						var date = new Date(data.rows[0].publicDate);
						date = date.getFullYear()+"-"+date.getMonth()+"-"+date.getDate();
						 $('#infoManage-form').form('load', 
								 {
							 		enterpriseName:data.rows[0].enterprise.enterpriseName,
							 		publicDate:date,
							 		acceptor:data.rows[0].enterprise.acceptor,
							 	 	enterpriseType:data.rows[0].enterprise.enterpriseType,
							 		countries:data.rows[0].enterprise.countries,
							 		publicContent:data.rows[0].publicContent
								 });
					}
					else{
						$('#infoManage-dialog').dialog();
					} 
				}	
			});
			$('#infoManage-dialog').dialog({
				closed: false,
				modal:true,
	            title: "查看信息"
	        });
		}
	});
</script>